---
phase: 02-structured-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/src/lib/structured-data.ts
  - apps/web/src/app/hogskoleprovet/[slug]/page.tsx
  - apps/web/src/app/hogskoleprovet/page.tsx
autonomous: true

must_haves:
  truths:
    - "Test detail pages include Article JSON-LD with datePublished and publisher"
    - "All pages include BreadcrumbList JSON-LD showing Swedish navigation hierarchy"
    - "JSON-LD renders as script tags in page HTML source"
  artifacts:
    - path: "apps/web/src/lib/structured-data.ts"
      provides: "JsonLd component and schema generator functions"
      exports: ["JsonLd", "generateArticleJsonLd", "generateBreadcrumbJsonLd"]
      min_lines: 50
    - path: "apps/web/src/app/hogskoleprovet/[slug]/page.tsx"
      provides: "Test detail page with Article and Breadcrumb JSON-LD"
      contains: "application/ld+json"
    - path: "apps/web/src/app/hogskoleprovet/page.tsx"
      provides: "Test list page with Breadcrumb JSON-LD"
      contains: "application/ld+json"
  key_links:
    - from: "apps/web/src/app/hogskoleprovet/[slug]/page.tsx"
      to: "apps/web/src/lib/structured-data.ts"
      via: "import { JsonLd, generateArticleJsonLd, generateBreadcrumbJsonLd }"
      pattern: "import.*from.*structured-data"
    - from: "apps/web/src/app/hogskoleprovet/page.tsx"
      to: "apps/web/src/lib/structured-data.ts"
      via: "import { JsonLd, generateBreadcrumbJsonLd }"
      pattern: "import.*from.*structured-data"
---

<objective>
Add JSON-LD structured data to hogskoleprovet pages for rich snippet eligibility in Google search results.

Purpose: Enable test pages to qualify for Google rich results (enhanced search snippets) by adding properly structured Article and BreadcrumbList schemas.

Output: All test pages render valid JSON-LD that passes Google Rich Results Test validation.
</objective>

<execution_context>
@/Users/williamlarsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/williamlarsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-structured-data/02-RESEARCH.md

# Source files to modify
@apps/web/src/app/hogskoleprovet/[slug]/page.tsx
@apps/web/src/app/hogskoleprovet/page.tsx
@apps/web/src/data/tests.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create structured-data helper library</name>
  <files>
    apps/web/package.json
    apps/web/src/lib/structured-data.ts
  </files>
  <action>
1. Install schema-dts as dev dependency:
   ```bash
   cd apps/web && bun add -D schema-dts
   ```

2. Create `apps/web/src/lib/structured-data.ts` with:

   a) JsonLd component for safe rendering:
   ```typescript
   interface JsonLdProps {
     data: Record<string, unknown>;
   }

   export function JsonLd({ data }: JsonLdProps) {
     return (
       <script
         type="application/ld+json"
         dangerouslySetInnerHTML={{
           __html: JSON.stringify(data).replace(/</g, '\\u003c'),
         }}
       />
     );
   }
   ```

   b) generateArticleJsonLd function:
   - Takes Test object from @/data/tests
   - Returns WithContext<Article> schema
   - headline: "Hogskoleprovet {season} {year} - PDF, Facit & Normering"
   - datePublished: test.date (ISO format)
   - publisher: { @type: Organization, name: Maxa, url: https://maxa.se }
   - mainEntityOfPage: { @type: WebPage, @id: https://maxa.se/hogskoleprovet/{slug} }

   c) generateBreadcrumbJsonLd function:
   - Takes optional Test object (for detail pages) or nothing (for list page)
   - Returns WithContext<BreadcrumbList> schema
   - Swedish labels: "Hem", "Gamla prov", "{Varen|Hosten} {year}"
   - position property starts at 1
   - Final item omits 'item' property per Google docs
   - Base URL: https://maxa.se

IMPORTANT: Use Article schema, NOT ScholarlyArticle (Google only supports Article for rich results).
IMPORTANT: Use native script tag, NOT next/script (hydration duplication issues).
IMPORTANT: Season labels must use Swedish special characters properly:
  - "vår" -> "Varen" (for breadcrumb display)
  - "höst" -> "Hosten" (for breadcrumb display)
  </action>
  <verify>
1. `bun run lint` passes in apps/web
2. File exists at apps/web/src/lib/structured-data.ts
3. schema-dts appears in devDependencies in package.json
  </verify>
  <done>
structured-data.ts exports JsonLd component and both generator functions with proper TypeScript types from schema-dts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add JSON-LD to test detail page</name>
  <files>apps/web/src/app/hogskoleprovet/[slug]/page.tsx</files>
  <action>
1. Import from structured-data library:
   ```typescript
   import { JsonLd, generateArticleJsonLd, generateBreadcrumbJsonLd } from '@/lib/structured-data';
   ```

2. In TestPage component, after getting the test object:
   - Generate articleJsonLd using generateArticleJsonLd(test)
   - Generate breadcrumbJsonLd using generateBreadcrumbJsonLd(test)

3. Add JsonLd components to the returned JSX, BEFORE the main content div:
   ```tsx
   return (
     <div className="min-h-screen flex flex-col bg-background">
       <JsonLd data={articleJsonLd} />
       <JsonLd data={breadcrumbJsonLd} />
       <SiteHeader />
       {/* rest of content */}
     </div>
   );
   ```

IMPORTANT: Do NOT use Fragment (<></>) - place JsonLd components inside the existing root div.
IMPORTANT: Render BOTH Article and BreadcrumbList schemas as separate script tags.
  </action>
  <verify>
1. `bun run lint` passes
2. Run `bun run build` in apps/web - no TypeScript errors
3. View page source at http://localhost:3000/hogskoleprovet/hosten-2024 - two script tags with type="application/ld+json" present
  </verify>
  <done>
Test detail page renders Article JSON-LD with headline, datePublished, publisher AND BreadcrumbList JSON-LD with Hem > Gamla prov > {season} {year}.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add JSON-LD to test list page</name>
  <files>apps/web/src/app/hogskoleprovet/page.tsx</files>
  <action>
1. Import from structured-data library:
   ```typescript
   import { JsonLd, generateBreadcrumbJsonLd } from '@/lib/structured-data';
   ```

2. In HogskoleprovPage component, add breadcrumb JSON-LD:
   - Call generateBreadcrumbJsonLd() with no arguments (list page has 2-level breadcrumb: Hem > Gamla prov)

3. Add JsonLd component inside the root div, before SiteHeader:
   ```tsx
   return (
     <div className="min-h-screen flex flex-col bg-background">
       <JsonLd data={generateBreadcrumbJsonLd()} />
       <SiteHeader />
       {/* rest of content */}
     </div>
   );
   ```

NOTE: List page only gets BreadcrumbList, NOT Article schema (it's not an article page).
  </action>
  <verify>
1. `bun run lint` passes
2. `bun run build` in apps/web - no TypeScript errors
3. View page source at http://localhost:3000/hogskoleprovet - one script tag with type="application/ld+json" and BreadcrumbList content
  </verify>
  <done>
Test list page renders BreadcrumbList JSON-LD with "Hem > Gamla prov" navigation hierarchy.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build verification:
   ```bash
   cd apps/web && bun run build
   ```
   Must complete without errors.

2. JSON-LD presence check (start dev server first):
   - Visit http://localhost:3000/hogskoleprovet
   - View page source, search for "application/ld+json"
   - Should find BreadcrumbList with "Hem", "Gamla prov"

   - Visit http://localhost:3000/hogskoleprovet/hosten-2024
   - View page source, search for "application/ld+json"
   - Should find TWO script tags:
     - Article with headline, datePublished, publisher
     - BreadcrumbList with "Hem", "Gamla prov", "Hosten 2024"

3. Schema validation (manual):
   - Copy JSON-LD content from page source
   - Paste into https://search.google.com/test/rich-results
   - Should show no errors (warnings acceptable)
</verification>

<success_criteria>
- [ ] schema-dts installed as dev dependency
- [ ] structured-data.ts exists with JsonLd, generateArticleJsonLd, generateBreadcrumbJsonLd exports
- [ ] Test detail pages render Article + BreadcrumbList JSON-LD
- [ ] Test list page renders BreadcrumbList JSON-LD
- [ ] `bun run build` succeeds without errors
- [ ] JSON-LD visible in page source with correct structure
</success_criteria>

<output>
After completion, create `.planning/phases/02-structured-data/02-01-SUMMARY.md`
</output>
