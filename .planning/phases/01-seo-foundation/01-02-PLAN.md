---
phase: 01-seo-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/layout.tsx
  - apps/web/src/app/hogskoleprovet/page.tsx
  - apps/web/src/app/hogskoleprovet/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Root layout has metadataBase set to https://maxa.se"
    - "List page /hogskoleprovet has canonical URL in metadata"
    - "Each test detail page has canonical URL in metadata"
    - "OpenGraph URLs resolve correctly with metadataBase"
  artifacts:
    - path: "apps/web/src/app/layout.tsx"
      provides: "metadataBase configuration"
      contains: "metadataBase"
    - path: "apps/web/src/app/hogskoleprovet/page.tsx"
      provides: "Canonical URL for list page"
      contains: "alternates"
    - path: "apps/web/src/app/hogskoleprovet/[slug]/page.tsx"
      provides: "Canonical URLs for test pages"
      contains: "alternates"
  key_links:
    - from: "apps/web/src/app/hogskoleprovet/[slug]/page.tsx"
      to: "metadataBase"
      via: "relative canonical URLs"
      pattern: "canonical.*hogskoleprovet"
    - from: "apps/web/src/app/layout.tsx"
      to: "https://maxa.se"
      via: "metadataBase URL"
      pattern: "metadataBase.*new URL"
---

<objective>
Add metadataBase and canonical URLs to all pages

Purpose: Canonical URLs prevent duplicate content issues and tell search engines the preferred URL for each page. metadataBase enables relative URL resolution for canonicals and OpenGraph URLs.

Output: Updated layout.tsx with metadataBase, and canonical URLs added to list page and all test detail pages
</objective>

<execution_context>
@/Users/williamlarsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/williamlarsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-seo-foundation/01-RESEARCH.md

# Existing files to modify
@apps/web/src/app/layout.tsx
@apps/web/src/app/hogskoleprovet/page.tsx
@apps/web/src/app/hogskoleprovet/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add metadataBase to root layout</name>
  <files>apps/web/src/app/layout.tsx</files>
  <action>
Modify `apps/web/src/app/layout.tsx` to add metadataBase to the existing metadata export:

1. Add `metadataBase: new URL('https://maxa.se')` to the metadata object
2. Keep all existing metadata fields (title, description, keywords, openGraph)

Current metadata:
```typescript
export const metadata: Metadata = {
  title: 'Maxa - Högskoleprovet Prep',
  description: '...',
  keywords: [...],
  openGraph: {...},
};
```

Updated metadata:
```typescript
export const metadata: Metadata = {
  metadataBase: new URL('https://maxa.se'),
  title: 'Maxa - Högskoleprovet Prep',
  description: '...',
  keywords: [...],
  openGraph: {...},
};
```

Important: metadataBase should NOT have a trailing slash. This enables all relative URLs in metadata to resolve to absolute URLs.
  </action>
  <verify>
1. TypeScript compiles without errors: `cd apps/web && bun run build` (or just check types)
2. View page source in browser and confirm OpenGraph URLs are now absolute (https://maxa.se/...)
  </verify>
  <done>
Root layout has metadataBase: new URL('https://maxa.se') in metadata export
  </done>
</task>

<task type="auto">
  <name>Task 2: Add canonical URL to list page</name>
  <files>apps/web/src/app/hogskoleprovet/page.tsx</files>
  <action>
Modify `apps/web/src/app/hogskoleprovet/page.tsx` to add canonical URL to the existing metadata export:

1. Add `alternates: { canonical: '/hogskoleprovet' }` to the metadata object
2. Add `url: '/hogskoleprovet'` to the openGraph object (for consistency)
3. Keep all existing metadata fields

Current metadata:
```typescript
export const metadata: Metadata = {
  title: "Gamla Högskoleprov...",
  description: "...",
  keywords: [...],
  openGraph: {
    title: "...",
    description: "...",
    type: "website",
  },
};
```

Updated metadata:
```typescript
export const metadata: Metadata = {
  title: "Gamla Högskoleprov...",
  description: "...",
  keywords: [...],
  alternates: {
    canonical: '/hogskoleprovet',
  },
  openGraph: {
    title: "...",
    description: "...",
    type: "website",
    url: '/hogskoleprovet',
  },
};
```

Important: Use relative URL `/hogskoleprovet` (not absolute). metadataBase in layout.tsx will resolve it to `https://maxa.se/hogskoleprovet`.
  </action>
  <verify>
1. Visit http://localhost:3000/hogskoleprovet
2. View page source
3. Confirm `<link rel="canonical" href="https://maxa.se/hogskoleprovet">` is present
4. Confirm `<meta property="og:url" content="https://maxa.se/hogskoleprovet">` is present
  </verify>
  <done>
List page has canonical URL in head: `<link rel="canonical" href="https://maxa.se/hogskoleprovet">`
  </done>
</task>

<task type="auto">
  <name>Task 3: Add canonical URLs to test detail pages</name>
  <files>apps/web/src/app/hogskoleprovet/[slug]/page.tsx</files>
  <action>
Modify the `generateMetadata` function in `apps/web/src/app/hogskoleprovet/[slug]/page.tsx`:

1. Add `alternates: { canonical: `/hogskoleprovet/${slug}` }` to the returned metadata
2. Add `url: `/hogskoleprovet/${slug}` ` to the openGraph object

Current return (simplified):
```typescript
return {
  title,
  description,
  keywords: [...],
  openGraph: {
    title,
    description,
    type: "article",
  },
};
```

Updated return:
```typescript
return {
  title,
  description,
  keywords: [...],
  alternates: {
    canonical: `/hogskoleprovet/${slug}`,
  },
  openGraph: {
    title,
    description,
    type: "article",
    url: `/hogskoleprovet/${slug}`,
  },
};
```

Important: Use template literal with `slug` variable. metadataBase will resolve to full URL.
  </action>
  <verify>
1. Visit http://localhost:3000/hogskoleprovet/hosten-2025
2. View page source
3. Confirm `<link rel="canonical" href="https://maxa.se/hogskoleprovet/hosten-2025">` is present
4. Confirm `<meta property="og:url" content="https://maxa.se/hogskoleprovet/hosten-2025">` is present
5. Test another page (e.g., /hogskoleprovet/varen-2024) to confirm dynamic canonical works
  </verify>
  <done>
All test detail pages have canonical URLs matching their slug: `<link rel="canonical" href="https://maxa.se/hogskoleprovet/{slug}">`
  </done>
</task>

</tasks>

<verification>
1. Start dev server: `bun dev:web`
2. Check root layout: Confirm metadataBase is set (TypeScript compilation succeeds)
3. Check list page: `curl -s http://localhost:3000/hogskoleprovet | grep -E '(canonical|og:url)'`
   - Should show canonical link and og:url with https://maxa.se/hogskoleprovet
4. Check test page: `curl -s http://localhost:3000/hogskoleprovet/hosten-2025 | grep -E '(canonical|og:url)'`
   - Should show canonical link and og:url with https://maxa.se/hogskoleprovet/hosten-2025
5. Build check: `cd apps/web && bun run build` should complete without errors
</verification>

<success_criteria>
- metadataBase set in root layout
- /hogskoleprovet has canonical URL tag in rendered HTML
- /hogskoleprovet/[slug] pages have canonical URL tags matching their slugs
- All OpenGraph URLs resolve to absolute URLs
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-seo-foundation/01-02-SUMMARY.md`
</output>
