---
phase: 03-main-app-experience
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - apps/mobile/app/(tabs)/index.tsx
  - apps/mobile/app/(tabs)/trana.tsx
autonomous: true

must_haves:
  truths:
    - "Idag tab displays real streak from gamificationStore"
    - "Idag tab shows actual daily goal progress that persists"
    - "Primary CTA button is prominent and obvious"
    - "Trana tab starts quiz sessions with selected mode"
    - "Smart mode uses weakness-based ordering (hardcoded until real tracking in Phase 4)"
    - "Design tokens used consistently (no hardcoded colors in modified files)"
  artifacts:
    - path: "apps/mobile/app/(tabs)/index.tsx"
      provides: "Idag tab with real state, prominent CTA"
    - path: "apps/mobile/app/(tabs)/trana.tsx"
      provides: "Trana tab with functional quiz start"
  key_links:
    - from: "apps/mobile/app/(tabs)/index.tsx"
      to: "apps/mobile/stores/gamificationStore.ts"
      via: "useGamificationStore hook"
      pattern: "useGamificationStore"
    - from: "apps/mobile/app/(tabs)/trana.tsx"
      to: "apps/mobile/app/quiz/index.tsx"
      via: "router.push navigation"
      pattern: "router.push.*quiz"
---

<objective>
Connect Idag and Trana tabs to real Zustand state, enhance the primary CTA for obvious daily action, and ensure Trana modes correctly start quiz sessions.

Purpose: Transform mock data displays into live state connections; make daily practice action unmissable
Output: Polished Idag and Trana tabs connected to gamificationStore with engaging UX
</objective>

<execution_context>
@/Users/williamlarsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/williamlarsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-main-app-experience/03-CONTEXT.md
@.planning/phases/03-main-app-experience/03-RESEARCH.md

# Prior plan output
@.planning/phases/03-main-app-experience/03-01-SUMMARY.md

# Current implementations to modify
@apps/mobile/app/(tabs)/index.tsx
@apps/mobile/app/(tabs)/trana.tsx
@apps/mobile/stores/gamificationStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Connect Idag tab to gamificationStore with enhanced CTA</name>
  <files>apps/mobile/app/(tabs)/index.tsx</files>
  <action>
    Update the Idag tab to use real state from gamificationStore instead of MOCK_USER.

    **Replace mock data with real state:**
    ```typescript
    import { useGamificationStore } from '@/stores';
    import { useProgressStore } from '@/stores';

    const {
      currentStreak,
      dailyProgress,
      dailyGoal,
      isDailyGoalComplete,
      checkAndUpdateStreak,
    } = useGamificationStore();
    const { totalXP } = useProgressStore();

    // Call checkAndUpdateStreak on component mount to handle streak logic
    useEffect(() => {
      checkAndUpdateStreak();
    }, []);
    ```

    **Keep mock data for elements not yet connected:**
    - examDate, goalScore, dreamProgram, dreamCity (these come from onboarding, Phase 4)
    - weeklyCorrect, weakestSection (need real tracking)
    - User name (from auth, future)

    Create a constants object for remaining mock data:
    ```typescript
    const USER_PROFILE = {
      name: 'Emma', // Will come from auth
      examDate: new Date(2026, 3, 5),
      goalScore: 1.8,
      dreamProgram: 'L√§karprogrammet',
      dreamCity: 'Lund',
    };
    ```

    **Enhance primary CTA button (from CONTEXT.md: "super obvious and always visible"):**
    - Make the CTA more prominent with larger size and stronger visual weight
    - Add pulsing animation when daily goal not complete
    - Show progress toward daily goal on the button

    ```typescript
    // Add pulsing glow animation when goal not complete
    const ctaScale = useSharedValue(1);

    useEffect(() => {
      if (!isDailyGoalComplete()) {
        ctaScale.value = withRepeat(
          withSequence(
            withTiming(1.02, { duration: 1000 }),
            withTiming(1, { duration: 1000 })
          ),
          -1,
          true
        );
      } else {
        ctaScale.value = 1;
      }
    }, [isDailyGoalComplete]);

    const ctaAnimatedStyle = useAnimatedStyle(() => ({
      transform: [{ scale: ctaScale.value }],
    }));
    ```

    **Update CTA button text dynamically:**
    ```typescript
    const getCtaText = () => {
      if (isDailyGoalComplete()) {
        return '‚úì M√ÖL UPPN√ÖTT - TR√ÑNA MER?';
      }
      if (dailyProgress === 0) {
        return '‚ñ∂ STARTA DAGENS PASS';
      }
      return `‚ñ∂ FORTS√ÑTT (${dailyProgress}/${dailyGoal})`;
    };
    ```

    **Connect CTA to navigation:**
    ```typescript
    const router = useRouter();

    const handleCtaPress = () => {
      triggerImpact(Haptics.ImpactFeedbackStyle.Medium);
      router.push({
        pathname: '/quiz',
        params: { section: 'MIXED' }, // Daily mix
      });
    };
    ```

    **Update streak display to use real value:**
    Replace `MOCK_USER.streak` with `currentStreak` from gamificationStore.

    **Update daily goal progress:**
    Replace `MOCK_USER.dailyProgress` and `MOCK_USER.dailyGoal` with store values.
  </action>
  <verify>
    TypeScript compiles: `cd apps/mobile && npx tsc --noEmit`
    App renders without crash on Idag tab
    Streak shows real value (likely 0 for fresh state)
  </verify>
  <done>
    Idag tab connected to gamificationStore:
    - Real streak count displayed
    - Real daily progress shown
    - Prominent CTA with pulse animation when goal incomplete
    - Navigation to quiz on CTA press
  </done>
</task>

<task type="auto">
  <name>Task 2: Connect Trana tab to quiz start with all modes functional</name>
  <files>apps/mobile/app/(tabs)/trana.tsx</files>
  <action>
    Update Trana tab to properly start quiz sessions for all modes.

    **Smart mode - pick weakest sections:**
    For now, use a simple "weakest first" approach (from RESEARCH.md):
    ```typescript
    // Mock weakness data until real tracking implemented
    const WEAKNESS_ORDER = ['NOG', 'KVA', 'MEK', 'ORD']; // Sorted by weakness

    const handleStartTraining = () => {
      triggerImpact(Haptics.ImpactFeedbackStyle.Medium);

      if (selectedMode === 'smart') {
        // Pick 2 weakest sections for smart mix
        const weakestSections = WEAKNESS_ORDER.slice(0, 2);
        router.push({
          pathname: '/quiz',
          params: {
            section: 'SMART',
            focusSections: weakestSections.join(','),
          },
        });
      } else if (selectedMode === 'section') {
        // Section mode handled by section tile press
        // Show a message if they press the main button without selecting
        console.log('Select a section above to start');
      } else if (selectedMode === 'simulate') {
        // Simulate mode - show "coming soon" or start full test
        router.push({
          pathname: '/quiz',
          params: {
            section: 'SIMULATE',
            questionCount: '160',
            timed: 'true',
          },
        });
      }
    };
    ```

    **Update section tile press to navigate:**
    Section tiles already call handleSectionPress which navigates correctly.
    Verify this works and the quiz receives the section param.

    **Show session info card for smart mode:**
    Add estimated time based on research (5-10 min sessions = 10-15 questions):
    ```typescript
    {selectedMode === 'smart' && (
      <Card>
        <View style={styles.smartInfoContent}>
          <View style={[styles.smartInfoIcon, { backgroundColor: colors.primaryLight }]}>
            <Text style={styles.smartInfoEmoji}>üéØ</Text>
          </View>
          <View style={styles.smartInfoText}>
            <Text variant="h5">10 fr√•gor</Text>
            <Text variant="bodySm" color="secondary">
              ~5 min ‚Ä¢ Fokus p√• {WEAKNESS_ORDER[0]} och {WEAKNESS_ORDER[1]}
            </Text>
          </View>
        </View>
      </Card>
    )}
    ```

    **Button text updates:**
    ```typescript
    {selectedMode === 'smart' && 'üéØ STARTA SMART TR√ÑNING'}
    {selectedMode === 'section' && 'V√ÑLJ DELPROV OVAN ‚Üë'}
    {selectedMode === 'simulate' && '‚è±Ô∏è STARTA SIMULERAT PROV'}
    ```

    **Disable simulate button if not implemented:**
    If simulate mode isn't fully implemented, show a disabled state or "Coming soon" badge:
    ```typescript
    <Button
      fullWidth
      size="xl"
      onPress={handleStartTraining}
      disabled={selectedMode === 'section'} // Disabled until section selected
    >
    ```
  </action>
  <verify>
    TypeScript compiles: `cd apps/mobile && npx tsc --noEmit`
    Smart mode navigates to /quiz with section=SMART
    Section mode tiles navigate to /quiz with correct section
    Simulate mode either navigates or shows coming soon
  </verify>
  <done>
    Trana tab modes functional:
    - Smart mode starts quiz with weakest-first logic
    - Section tiles navigate to correct section quiz
    - Session info shows estimated time
    - Button states reflect mode selection
  </done>
</task>

<task type="auto">
  <name>Task 3: Audit and unify component usage and design tokens</name>
  <files>apps/mobile/app/(tabs)/index.tsx, apps/mobile/app/(tabs)/trana.tsx</files>
  <action>
    After connecting tabs to state, audit for consistent component and token usage.

    **Search for hardcoded colors (AUDIT-05):**
    ```bash
    grep -n "#[0-9a-fA-F]\{3,6\}" apps/mobile/app/\(tabs\)/index.tsx apps/mobile/app/\(tabs\)/trana.tsx
    grep -n "rgb\|rgba\|hsl" apps/mobile/app/\(tabs\)/index.tsx apps/mobile/app/\(tabs\)/trana.tsx
    ```

    Replace any found with design tokens from `@/constants/theme`:
    - Hardcoded `#XXXXXX` ‚Üí `colors.xxx` from `Colors[colorScheme]`
    - Hardcoded `rgba()` ‚Üí theme tokens or `colors.xxx + 'XX'` for opacity

    **Verify component library usage (AUDIT-04):**
    Ensure both tabs use the shared UI components:
    - `<Text>` from `@/components/ui/text` (not raw `<Text>` from react-native)
    - `<Button>` from `@/components/ui/button`
    - `<Card>` from `@/components/ui/card`
    - `<ProgressBar>` from `@/components/ui/progress-bar`

    Check import statements at top of file - should import from `@/components/ui/`:
    ```typescript
    import { Text } from '@/components/ui/text';
    import { Button } from '@/components/ui/button';
    import { Card } from '@/components/ui/card';
    ```

    **Fix any inconsistencies:**
    - If using inline View with custom styling for card-like containers ‚Üí use Card
    - If using raw Text without variant ‚Üí use Text with appropriate variant
    - If defining colors inline ‚Üí extract to theme tokens
  </action>
  <verify>
    No hardcoded color hex codes remain: `grep "#[0-9a-fA-F]" apps/mobile/app/\(tabs\)/index.tsx` returns empty
    All Text, Button, Card imports come from @/components/ui/
    TypeScript compiles: `cd apps/mobile && npx tsc --noEmit`
  </verify>
  <done>
    Both tabs use:
    - Shared UI components (Text, Button, Card) from @/components/ui/
    - Design tokens for all colors
    - No hardcoded hex values
  </done>
</task>

</tasks>

<verification>
1. Run TypeScript check: `cd apps/mobile && npx tsc --noEmit`
2. Run linter: `bun run lint`
3. Test on device/simulator:
   - Idag tab shows streak, daily progress from store
   - CTA button navigates to quiz
   - Trana smart mode starts quiz
   - Trana section tiles navigate correctly
</verification>

<success_criteria>
- Idag tab displays real streak count from gamificationStore
- Idag tab shows real daily progress (questions toward goal)
- CTA button is prominent with pulse animation and navigates to quiz
- Trana smart mode navigates to quiz with weakest sections (mock data)
- Trana section tiles start section-specific quizzes
- Both tabs use shared UI components consistently (AUDIT-04)
- No hardcoded colors remain in modified files (AUDIT-05)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-main-app-experience/03-02-SUMMARY.md`
</output>
