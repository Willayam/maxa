---
phase: 05-cross-linking-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/lib/related-content.ts
  - apps/web/src/components/navigation/related-tests.tsx
  - apps/web/src/app/hogskoleprovet/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Test detail pages show 4 related tests section"
    - "Related tests prioritize same season and year proximity"
    - "Related tests section uses reusable component (not inline JSX)"
    - "Related tests link to other test pages with proper anchor text"
  artifacts:
    - path: "apps/web/src/lib/related-content.ts"
      provides: "Related tests algorithm"
      exports: ["getRelatedTests"]
    - path: "apps/web/src/components/navigation/related-tests.tsx"
      provides: "Related tests section component"
      exports: ["RelatedTests"]
  key_links:
    - from: "apps/web/src/app/hogskoleprovet/[slug]/page.tsx"
      to: "RelatedTests component"
      via: "import and render"
      pattern: "import.*RelatedTests"
    - from: "apps/web/src/components/navigation/related-tests.tsx"
      to: "getRelatedTests function"
      via: "import"
      pattern: "import.*getRelatedTests"
---

<objective>
Enhance related tests section with smart algorithm and extract to reusable component.

Purpose: Better related content improves user engagement and internal linking. Extracting to component enables reuse on future strategy pages (Phase 4).
Output: Reusable RelatedTests component with relevance-based sorting algorithm.
</objective>

<execution_context>
@/Users/williamlarsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/williamlarsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-cross-linking-polish/05-RESEARCH.md

@apps/web/src/app/hogskoleprovet/[slug]/page.tsx
@apps/web/src/data/tests.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create related content algorithm</name>
  <files>
    apps/web/src/lib/related-content.ts
  </files>
  <action>
Create `apps/web/src/lib/related-content.ts` with smart related tests algorithm:

```typescript
import { tests, type Test } from "@/data/tests"

/**
 * Get related tests based on relevance scoring.
 * Prioritizes: same season > year proximity > recency
 */
export function getRelatedTests(currentTest: Test, limit: number = 4): Test[] {
  return tests
    .filter(t => t.id !== currentTest.id)
    .map(t => ({
      test: t,
      score: calculateRelevanceScore(currentTest, t)
    }))
    .sort((a, b) => b.score - a.score)
    .slice(0, limit)
    .map(r => r.test)
}

function calculateRelevanceScore(current: Test, candidate: Test): number {
  let score = 0

  // Same season bonus: +10 points
  if (current.season === candidate.season) {
    score += 10
  }

  // Year proximity: -2 points per year difference
  // Closer years are more relevant
  const yearDiff = Math.abs(current.year - candidate.year)
  score -= yearDiff * 2

  // Recency bonus: newer tests get slight boost (max +5)
  const currentYear = new Date().getFullYear()
  const ageInYears = currentYear - candidate.year
  score += Math.max(0, 5 - ageInYears)

  return score
}
```

Key algorithm features:
- Same season tests rank higher (users practicing for spring want spring tests)
- Adjacent years rank higher than distant years
- Recent tests get slight boost (more relevant to current format)
- Returns sorted by relevance score descending
  </action>
  <verify>
    - File exists: apps/web/src/lib/related-content.ts
    - TypeScript compiles without errors
    - Algorithm logic: same-season tests should rank higher
  </verify>
  <done>
    Related content algorithm created with relevance-based scoring.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create RelatedTests component and integrate</name>
  <files>
    apps/web/src/components/navigation/related-tests.tsx
    apps/web/src/app/hogskoleprovet/[slug]/page.tsx
  </files>
  <action>
1. Create `apps/web/src/components/navigation/related-tests.tsx`:

```typescript
import Link from "next/link"
import type { Test } from "@/data/tests"
import { getRelatedTests } from "@/lib/related-content"

interface RelatedTestsProps {
  currentTest: Test
  limit?: number
}

export function RelatedTests({ currentTest, limit = 4 }: RelatedTestsProps) {
  const related = getRelatedTests(currentTest, limit)

  if (related.length === 0) return null

  return (
    <section className="mt-16 pt-8 border-t border-border">
      <h2 className="text-xl font-bold text-foreground mb-4">
        Fler hogskoleprov
      </h2>
      <div className="grid gap-3">
        {related.map(t => {
          const seasonLabel = t.season === "var" ? "Varen" : "Hosten"
          return (
            <Link
              key={t.id}
              href={`/hogskoleprovet/${t.slug}`}
              className="flex items-center justify-between p-4 bg-card-background rounded-xl border-2 border-border hover:border-primary transition-colors group"
            >
              <span className="font-semibold text-foreground group-hover:text-primary transition-colors">
                {seasonLabel} {t.year}
              </span>
              <span className="text-foreground-muted group-hover:text-primary">
                ->
              </span>
            </Link>
          )
        })}
      </div>
    </section>
  )
}
```

2. Update `apps/web/src/app/hogskoleprovet/[slug]/page.tsx`:
   - Import RelatedTests from @/components/navigation/related-tests
   - Replace the inline "Fler hogskoleprov" section (lines ~166-189) with:
     ```tsx
     <RelatedTests currentTest={test} />
     ```
   - Remove the inline tests.filter().slice().map() logic

This extracts the existing functionality to a reusable component while improving the algorithm.
  </action>
  <verify>
    - Run dev server: `cd apps/web && bun dev`
    - Visit http://localhost:3000/hogskoleprovet/hosten-2025
    - Related tests section shows 4 tests
    - Same-season tests (hosten-*) should appear before varen-* tests (when close in year)
    - Links navigate correctly to other test pages
  </verify>
  <done>
    RelatedTests component created and integrated, replacing inline implementation with reusable component.
  </done>
</task>

</tasks>

<verification>
1. Visit test detail page - related tests section visible with 4 tests
2. Check sorting: for hosten-2025, related tests should include other hosten tests ranked higher
3. Links work: clicking related test navigates to that test page
4. No duplicate: current test not shown in related tests
5. Code structure: algorithm in lib/, component in components/navigation/
</verification>

<success_criteria>
- Related tests algorithm considers season and year proximity
- RelatedTests component is reusable (props-based)
- Test detail pages use the new component
- 4 related tests displayed with proper styling
- Links navigate correctly with descriptive anchor text
</success_criteria>

<output>
After completion, create `.planning/phases/05-cross-linking-polish/05-02-SUMMARY.md`
</output>
